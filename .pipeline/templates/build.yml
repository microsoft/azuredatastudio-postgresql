steps:
- task: NodeTool@0
  inputs:
    versionSpec: '14.x'
  displayName: 'Install Node.js'
- powershell: |
    npm install -g yarn
    npm install -g vsce
    yarn install
    yarn run pgtoolsservice -o variables.version
    yarn run compile
    yarn run package
    yarn run package-offline-windows
  displayName: 'Installing Dependencies and build packages'
  condition: eq(variables['platform'], 'windows')

- task: CmdLine@2
  displayName: 'Installing Dependencies and build packages'
  condition: eq(variables['platform'], 'mac-x64')
  inputs:
    script: |
      npm install -g yarn
      npm install -g vsce
      yarn install
      yarn run pgtoolsservice -o variables.version
      yarn run compile
      yarn run package-offline-osx

- task: CmdLine@2
  displayName: 'Installing Dependencies and build packages'
  condition: eq(variables['platform'], 'mac-arm64')
  inputs:
    script: |
      npm install -g yarn
      npm install -g vsce
      yarn install
      yarn run pgtoolsservice -o variables.version
      yarn run compile
      yarn run package-offline-osx-arm64

- task: CmdLine@2
  displayName: 'Installing Dependencies and build packages'
  condition: eq(variables['platform'], 'ubuntu')
  inputs:
    script: |
      npm install -g yarn
      npm install -g vsce
      yarn install
      yarn run pgtoolsservice -o variables.version
      yarn run compile
      yarn run package-offline-linux